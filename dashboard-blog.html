<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª | Dandy</title>

  <!-- Ø®Ø· -->
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet">

  <!-- ======= Ø³ØªØ§ÙŠÙ„ Ø§Ù„Ø¯Ø§Ø´Ø¨ÙˆØ±Ø¯ (Ø¯Ø§Ø±Ùƒ - ÙÙ„Ø§Øª) Ù…Ø¯Ù…Ø¬ Ù‡Ù†Ø§ ======= -->
  <style>
  :root {
    --primary: #0d6efd;
    --primary-hover: #0b5ed7;
    --danger: #dc3545;
    --danger-hover: #bb2d3b;
    --warning: #ffc107;
    --warning-hover: #e0a800;
    --bg: #0f1113;
    --card-bg: #151719;
    --text: #e9eef8;
    --muted: #9aa3b2;
    --radius: 10px;
    --transition: 0.18s ease;
    --container-width: 980px;
  }

  *{box-sizing:border-box}
  body {
    margin: 0;
    padding: 22px;
    background: linear-gradient(180deg, #0b0d0f 0%, #0f1113 100%);
    color: var(--text);
    font-family: 'Tajawal', sans-serif;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    min-height:100vh;
  }

  .container {
    max-width: var(--container-width);
    margin: 0 auto;
    padding: 0 16px;
  }

  h1, h2 {
    margin: 0 0 18px 0;
    text-align: center;
    font-weight: 700;
    color: var(--text);
  }

  .card {
    background: var(--card-bg);
    border: 1px solid rgba(255,255,255,0.04);
    padding: 20px;
    border-radius: var(--radius);
    margin-bottom: 24px;
  }

  /* form layout */
  .grid {
    display: grid;
    grid-template-columns: 1fr 360px;
    gap: 18px;
    align-items: start;
  }

  @media (max-width: 980px) {
    .grid { grid-template-columns: 1fr; }
  }

  label {
    display: block;
    margin-bottom: 8px;
    color: var(--muted);
    font-weight: 600;
    font-size: 14px;
  }

  input[type="text"], input[type="url"], input[type="date"], textarea {
    width: 100%;
    padding: 12px 14px;
    border-radius: 10px;
    border: 1px solid rgba(255,255,255,0.04);
    background: #121417;
    color: var(--text);
    font-size: 14px;
    outline: none;
    transition: box-shadow var(--transition), border-color var(--transition);
  }
  input:focus, textarea:focus {
    border-color: var(--primary);
    box-shadow: 0 0 0 4px rgba(13,110,253,0.06);
  }

  .form-left { display:flex; flex-direction:column; gap:12px; }
  .form-right { display:flex; flex-direction:column; gap:12px; }

  /* buttons */
  .buttons-row { display:flex; gap:10px; align-items:center; margin-top:6px; flex-wrap:wrap; }
  .btn {
    padding: 10px 14px;
    border-radius: 10px;
    font-weight: 700;
    border: none;
    cursor: pointer;
    transition: transform var(--transition), background var(--transition);
    font-size: 14px;
  }
  .btn:active { transform: translateY(1px); }

  .btn-primary {
    background: linear-gradient(180deg,var(--primary),var(--primary-hover));
    color: #fff;
    box-shadow: 0 6px 18px rgba(13,110,253,0.12);
  }
  .btn-secondary {
    background: rgba(255,255,255,0.03);
    color: var(--text);
    border: 1px solid rgba(255,255,255,0.03);
  }
  .btn-cancel {
    background: #2c2f33;
    color: var(--muted);
  }

  /* table */
  .table-wrapper { overflow-x:auto; margin-top:6px; }
  table {
    width:100%;
    border-collapse: collapse;
    min-width: 620px;
    background: transparent;
  }
  th, td {
    padding: 12px 10px;
    border-bottom: 1px solid rgba(255,255,255,0.03);
    text-align: center;
    font-size: 14px;
    color: var(--text);
  }
  th {
    background: rgba(255,255,255,0.02);
    font-weight:700;
    color: var(--muted);
  }

  .action-btn {
    padding: 8px 10px;
    border-radius: 8px;
    border: none;
    cursor: pointer;
    font-weight:700;
    font-size:13px;
  }
  .action-edit { background: var(--warning); color:#000; }
  .action-delete { background: var(--danger); color:#fff; }
  .action-view { background: rgba(255,255,255,0.06); color:var(--text); }

  /* small helper */
  .note { color: var(--muted); font-size:13px; margin-top:6px; text-align:left; }
  .field-compact { display:flex; gap:8px; }
  .img-preview {
    width:100%;
    height:180px;
    object-fit:cover;
    border-radius:8px;
    background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(0,0,0,0.15));
    border:1px solid rgba(255,255,255,0.03);
  }

  /* responsive tweaks */
  @media (max-width: 620px) {
    .img-preview { height:140px; }
    th, td { font-size:12px; padding:10px; }
    .btn { font-size:13px; padding:9px 10px; }
  }

  /* TinyMCE editor container override to match dark (some classes) */
  .tox .tox-editor-header { background: transparent; border-bottom: 1px solid rgba(255,255,255,0.03); }
  .tox .tox-toolbar__group { background: transparent; }
  .tox .tox-toolbar__primary { background:transparent; }
  .tox .tox-editor-container { background: #111214; border-radius:8px; }
  .tox .tox-edit-area__iframe, .tox .tox-edit-area__iframe body { background: #0f1113; color: var(--text); }
  </style>

  <!-- TinyMCE (Ù…Ø¹ Ù…ÙØªØ§Ø­Ùƒ) -->
  <script src="https://cdn.tiny.cloud/1/93rdzigk7y2vd5l21kk3bvmhapd1shislzdzjclmvj1misis/tinymce/6/tinymce.min.js" referrerpolicy="origin"></script>
  <script>
    tinymce.init({
      selector: '#article-content',
      height: 420,
      directionality: 'rtl',
      language: 'ar',
      skin: 'oxide-dark',
      content_css: 'dark',
      menubar: false,
      plugins: [
        'anchor','autolink','charmap','codesample','emoticons','link','lists','media','searchreplace',
        'table','visualblocks','wordcount',
        'checklist','mediaembed','casechange','formatpainter','pageembed','a11ychecker',
        'tinymcespellchecker','permanentpen','powerpaste','advtable','advcode','advtemplate',
        'ai','uploadcare','mentions','tinycomments','tableofcontents','footnotes',
        'mergetags','autocorrect','typography','inlinecss','markdown','importword',
        'exportword','exportpdf'
      ],
      toolbar: 'undo redo | blocks fontfamily fontsize | bold italic underline strikethrough | alignleft aligncenter alignright alignjustify | lineheight | checklist numlist bullist indent outdent | link media table mergetags | emoticons charmap codesample | removeformat | addcomment showcomments spellcheckdialog a11ycheck typography uploadcare | exportword exportpdf',
      tinycomments_mode: 'embedded',
      tinycomments_author: 'Admin',
      mergetags_list: [
        { value: 'First.Name', title: 'First Name' },
        { value: 'Email', title: 'Email' }
      ],
      // AI placeholder (not implemented)
      ai_request: (request, respondWith) => respondWith.string(() => Promise.reject('AI Assistant needs activation')),
      uploadcare_public_key: 'a337a7488d5ac5c0f5c6'
    });
  </script>

</head>
<body>

  <div class="container">
    <div class="card">
      <h1>âœï¸ Ù„ÙˆØ­Ø© ØªØ­ÙƒÙ… Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</h1>

      <div class="grid" style="margin-top:14px;">
        <!-- Ø§Ù„ÙŠØ³Ø§Ø±: Ø§Ù„ÙÙˆØ±Ù… -->
        <div class="form-left">
          <label for="article-title">Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„</label>
          <input id="article-title" type="text" placeholder="Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù†Ù‹Ø§ Ø¬Ø°Ø§Ø¨Ù‹Ø§ Ù„Ù„Ù…Ù‚Ø§Ù„">

          <label for="article-image">Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„Ù…Ù‚Ø§Ù„</label>
          <input id="article-image" type="url" placeholder="https://... (Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø©)">

          <label for="article-date">ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
          <input id="article-date" type="date">

          <label for="article-content">Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù‚Ø§Ù„</label>
          <textarea id="article-content"></textarea>

          <div class="buttons-row" style="margin-top:6px;">
            <button id="submit-btn" class="btn btn-primary">â• Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„</button>
            <button id="reset-btn" class="btn btn-secondary">âœ–ï¸ Ù…Ø³Ø­ Ø§Ù„Ø­Ù‚ÙˆÙ„</button>
            <button id="preview-btn" class="btn btn-cancel">ğŸ‘ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø³Ø±ÙŠØ¹</button>
          </div>
          <div class="note">Ù…Ù„Ø§Ø­Ø¸Ø©: Ø§Ø­Ø±Øµ Ø¹Ù„Ù‰ Ø£Ù† ÙŠÙƒÙˆÙ† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø£ØµÙ„ÙŠÙ‹Ø§ ÙˆØ·ÙˆÙŠÙ„Ù‹Ø§ (ÙŠÙØ¶Ù„ â‰¥ 700 ÙƒÙ„Ù…Ø©) Ù„ØªØ­Ø³ÙŠÙ† ÙØ±Øµ Ù‚Ø¨ÙˆÙ„ AdSense.</div>
        </div>

        <!-- Ø§Ù„ÙŠÙ…ÙŠÙ†: Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© + Ù…Ø¹Ù„ÙˆÙ…Ø§Øª ØµØºÙŠØ±Ø© -->
        <div class="form-right">
          <div style="display:flex; flex-direction:column; gap:10px;">
            <div>
              <label>Ù…Ø¹Ø§ÙŠÙ†Ø© ØµÙˆØ±Ø© Ø§Ù„Ù…Ù‚Ø§Ù„</label>
              <img id="img-preview" class="img-preview" alt="Ù…Ø¹Ø§ÙŠÙ†Ø© ØµÙˆØ±Ø© Ø§Ù„Ù…Ù‚Ø§Ù„" src="" onerror="this.style.opacity=0.6; this.style.objectFit='contain'">
            </div>

            <div class="card" style="padding:12px;">
              <div style="display:flex; justify-content:space-between; align-items:center; gap:8px;">
                <div>
                  <div style="font-weight:700; color:var(--muted); font-size:13px;">Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„</div>
                  <div id="status-msg" style="font-weight:700; color:var(--text); margin-top:6px; font-size:13px;">Ø¬Ø§Ù‡Ø² Ù„Ù„Ø¹Ù…Ù„</div>
                </div>
                <div>
                  <div style="font-weight:700; color:var(--muted); font-size:13px; text-align:center;">Ù…Ù‚Ø§Ù„Ø§Øª Ù…Ø®Ø²Ù†Ø©</div>
                  <div id="count-articles" style="font-weight:700; color:var(--primary); font-size:18px; text-align:center; margin-top:6px;">0</div>
                </div>
              </div>
            </div>

            <div class="card" style="padding:12px; text-align:left; color:var(--muted); font-size:13px;">
              <div style="font-weight:700; color:var(--muted); margin-bottom:8px;">Ù†ØµØ§Ø¦Ø­ Ø³Ø±ÙŠØ¹Ø©</div>
              <ul style="margin:0 0 0 14px; padding:0; list-style:disc;">
                <li>Ø§Ø³ØªØ®Ø¯Ù… Ø¹Ù†Ø§ÙˆÙŠÙ† ÙØ±Ø¹ÙŠØ© (H2,H3) Ø¯Ø§Ø®Ù„ Ø§Ù„Ù…Ù‚Ø§Ù„.</li>
                <li>Ø£Ø¶Ù ØµÙˆØ±Ù‹Ø§ ÙˆÙÙˆØ§ØµÙ„ Ù„Ø³Ù‡ÙˆÙ„Ø© Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©.</li>
                <li>ØªØ£ÙƒØ¯ Ù…Ù† Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© ØµØ­ÙŠØ­ Ù„ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„Ù…Ø¹Ø§ÙŠÙ†Ø©.</li>
              </ul>
            </div>

          </div>
        </div>
      </div> <!-- end grid -->
    </div> <!-- end card -->

    <!-- Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª -->
    <div class="card">
      <h2>ğŸ“Œ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©</h2>
      <div class="table-wrapper">
        <table aria-live="polite">
          <thead>
            <tr>
              <th>Ø§Ù„ØµÙˆØ±Ø©</th>
              <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
              <th>ØªØ§Ø±ÙŠØ® Ø§Ù„Ù†Ø´Ø±</th>
              <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
            </tr>
          </thead>
          <tbody id="articles-list">
            <!-- Ù…Ù‚Ø§Ù„Ø§Øª ØªÙØ­Ù…Ù‘Ù„ Ø¨ÙˆØ§Ø³Ø·Ø© JS -->
          </tbody>
        </table>
      </div>
    </div>

  </div> <!-- end container -->

  <script>
  // Ù…Ù†Ø¹ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ø¯ÙˆÙ† ØªØ³Ø¬ÙŠÙ„
  if(localStorage.getItem("loggedIn") !== "true") {
    window.location.href = "login.html";
  }
</script>

  <!-- Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

  <script>
    // ===== Ø¥Ø¹Ø¯Ø§Ø¯ Firebase =====
    const firebaseConfig = {
      apiKey: "AIzaSyDqYY4EF0Nig9aBOxmWZJA8D-4Gr4tT-UU",
      authDomain: "dandy-562fc.firebaseapp.com",
      projectId: "dandy-562fc",
      storageBucket: "dandy-562fc.appspot.com",
      messagingSenderId: "454972972842",
      appId: "1:454972972842:web:fedc5e92e258a06ca08853"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // Ø¹Ù†Ø§ØµØ± DOM
    const titleEl = document.getElementById('article-title');
    const imageEl = document.getElementById('article-image');
    const dateEl = document.getElementById('article-date');
    const submitBtn = document.getElementById('submit-btn');
    const resetBtn = document.getElementById('reset-btn');
    const previewBtn = document.getElementById('preview-btn');
    const imgPreview = document.getElementById('img-preview');
    const articlesList = document.getElementById('articles-list');
    const countArticles = document.getElementById('count-articles');
    const statusMsg = document.getElementById('status-msg');

    let editId = null; // Ù„Ùˆ ÙÙŠ ØªØ¹Ø¯ÙŠÙ„

    // ØªØ­Ø¯ÙŠØ« Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© Ø¹Ù†Ø¯ ØªØºÙŠÙŠØ± Ø§Ù„Ø±Ø§Ø¨Ø·
    imageEl.addEventListener('input', () => {
      const url = imageEl.value.trim();
      imgPreview.src = url || '';
      imgPreview.style.opacity = url ? '1' : '0.35';
    });

    // reset
    resetBtn.addEventListener('click', (e) => {
      e.preventDefault();
      clearForm();
    });

    // Ù…Ø¹Ø§ÙŠÙ†Ø© Ø³Ø±ÙŠØ¹ (ÙŠÙØªØ­ Ù†Ø§ÙØ°Ø© Ø¬Ø¯ÙŠØ¯Ø© Ø¨Ø¹Ø±Ø¶ HTML Ø¨Ø³ÙŠØ·)
    previewBtn.addEventListener('click', (e) => {
      e.preventDefault();
      const title = titleEl.value.trim() || 'Ø¹Ù†ÙˆØ§Ù† ØªØ¬Ø±ÙŠØ¨ÙŠ';
      const image = imageEl.value.trim() || '';
      const content = tinymce.get('article-content').getContent() || '<p>Ù…Ø­ØªÙˆÙ‰ ØªØ¬Ø±ÙŠØ¨ÙŠ</p>';
      const date = dateEl.value || new Date().toLocaleDateString('ar-EG');

      const html = `
        <html lang="ar" dir="rtl">
        <head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Ù…Ø¹Ø§ÙŠÙ†Ø©</title>
        <style>body{font-family: Tajawal, sans-serif; background:#0f1113; color:#e9eef8; padding:20px} img{max-width:100%; border-radius:8px}</style>
        </head>
        <body>
        <h1>${escapeHtml(title)}</h1>
        <div style="color:#9aa3b2;margin-bottom:8px">${escapeHtml(date)}</div>
        ${image ? `<img src="${escapeHtml(image)}" alt="image" style="margin-bottom:14px">` : ''}
        <div>${content}</div>
        </body></html>`;
      const w = window.open('', '_blank');
      w.document.write(html);
      w.document.close();
    });

    // Ø¥Ø¶Ø§ÙØ© Ù…Ù‚Ø§Ù„
    submitBtn.addEventListener('click', async (e) => {
      e.preventDefault();
      await handleSubmit();
    });

    async function handleSubmit() {
      const title = titleEl.value.trim();
      const image = imageEl.value.trim();
      const content = tinymce.get('article-content').getContent().trim();
      const dateValue = dateEl.value;
      const readableDate = dateValue ? new Date(dateValue).toLocaleDateString('ar-EG') : new Date().toLocaleDateString('ar-EG');

      if (!title || !content) {
        alert('Ù…Ù† ÙØ¶Ù„Ùƒ Ø£Ø¯Ø®Ù„ Ø¹Ù†ÙˆØ§Ù† ÙˆÙ…Ø­ØªÙˆÙ‰ Ù„Ù„Ù…Ù‚Ø§Ù„');
        return;
      }

      submitBtn.disabled = true;
      submitBtn.innerText = editId ? 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«...' : 'Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø±...';

      try {
        if (editId) {
          // ØªØ­Ø¯ÙŠØ«
          await db.collection('articles').doc(editId).update({
            title,
            image,
            content,
            date: readableDate,
            updatedAt: firebase.firestore.FieldValue.serverTimestamp()
          });
          editId = null;
          submitBtn.innerText = 'â• Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„';
          alert('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‚Ø§Ù„ âœ…');
        } else {
          // Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯
          await db.collection('articles').add({
            title,
            image,
            content,
            date: readableDate,
            createdAt: firebase.firestore.FieldValue.serverTimestamp()
          });
          alert('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù‚Ø§Ù„ âœ…');
        }
        clearForm();
        loadArticles();
      } catch (err) {
        console.error(err);
        alert('Ø­ØµÙ„ Ø®Ø·Ø£ØŒ Ø¬Ø±Ø¨ Ù…Ø±Ø© ØªØ§Ù†ÙŠØ©');
      } finally {
        submitBtn.disabled = false;
      }
    }

    function clearForm() {
      titleEl.value = '';
      imageEl.value = '';
      dateEl.value = '';
      tinymce.get('article-content').setContent('');
      imgPreview.src = '';
      imgPreview.style.opacity = 0.35;
      editId = null;
      submitBtn.disabled = false;
      submitBtn.innerText = 'â• Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„';
    }

    // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª
    async function loadArticles() {
      articlesList.innerHTML = '<tr><td colspan="4" style="color:var(--muted)">... Ø¬Ø§Ø±Ù Ø§Ù„ØªØ­Ù…ÙŠÙ„</td></tr>';
      try {
        const snapshot = await db.collection('articles').orderBy('createdAt', 'desc').get();
        const docs = snapshot.docs || [];
        countArticles.innerText = docs.length;
        if (docs.length === 0) {
          articlesList.innerHTML = '<tr><td colspan="4" style="color:var(--muted)">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù‚Ø§Ù„Ø§Øª Ø­ØªÙ‰ Ø§Ù„Ø¢Ù†</td></tr>';
          return;
        }
        articlesList.innerHTML = '';
        docs.forEach(doc => {
          const data = doc.data();
          const id = doc.id;
          const title = escapeHtml(data.title || 'Ø¨Ø¯ÙˆÙ† Ø¹Ù†ÙˆØ§Ù†');
          const date = escapeHtml(data.date || '');
          const image = data.image || '';
          const row = document.createElement('tr');

          row.innerHTML = `
            <td style="width:120px">
              ${image ? `<img src="${escapeHtml(image)}" alt="img" style="width:100px;height:60px;object-fit:cover;border-radius:6px;border:1px solid rgba(255,255,255,0.03)">` : '<div style="width:100px;height:60px;background:rgba(255,255,255,0.02);border-radius:6px;display:flex;align-items:center;justify-content:center;color:var(--muted)">Ù„Ø§ ØµÙˆØ±Ø©</div>'}
            </td>
            <td style="text-align:right"><strong>${title}</strong></td>
            <td>${date}</td>
            <td>
              <button class="action-btn action-view" onclick="openArticleView('${id}')">Ø¹Ø±Ø¶</button>
              <button class="action-btn action-edit" onclick="startEdit('${id}')">ØªØ¹Ø¯ÙŠÙ„</button>
              <button class="action-btn action-delete" onclick="deleteArticle('${id}')">Ø­Ø°Ù</button>
            </td>
          `;
          articlesList.appendChild(row);
        });
      } catch (err) {
        console.error(err);
        articlesList.innerHTML = '<tr><td colspan="4" style="color:var(--muted)">Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª</td></tr>';
      }
    }

    // Ø­Ø°Ù Ù…Ù‚Ø§Ù„
    async function deleteArticle(id) {
      if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù‚Ø§Ù„ØŸ')) return;
      try {
        await db.collection('articles').doc(id).delete();
        alert('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù‚Ø§Ù„ âœ…');
        loadArticles();
      } catch (err) {
        console.error(err);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø­Ø°Ù');
      }
    }

    // Ø¨Ø¯Ø¡ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„: ØªØ­Ù…ÙŠÙ„ Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù‚Ø§Ù„ Ø¥Ù„Ù‰ Ø§Ù„ÙÙˆØ±Ù…
    async function startEdit(id) {
      try {
        const doc = await db.collection('articles').doc(id).get();
        if (!doc.exists) { alert('Ø§Ù„Ù…Ù‚Ø§Ù„ ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯'); return; }
        const data = doc.data();
        titleEl.value = data.title || '';
        imageEl.value = data.image || '';
        dateEl.value = data.date ? formatInputDate(data.date) : '';
        tinymce.get('article-content').setContent(data.content || '');
        imgPreview.src = data.image || '';
        imgPreview.style.opacity = data.image ? 1 : 0.35;
        editId = id;
        submitBtn.innerText = 'â¬†ï¸ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù‚Ø§Ù„';
        window.scrollTo({ top: 0, behavior: 'smooth' });
      } catch (err) {
        console.error(err);
        alert('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¬Ù„Ø¨ Ø§Ù„Ù…Ù‚Ø§Ù„');
      }
    }

    // ÙØªØ­ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù‚Ø§Ù„ (ÙŠÙØªØ­ ØµÙØ­Ø© Ø¬Ø¯ÙŠØ¯Ø© Ù…Ø¹ id ÙÙŠ Ø§Ù„Ø±Ø§Ø¨Ø·)
    function openArticleView(id) {
      // ØªÙˆÙ‚Ø¹ Ø£Ù† Ù„Ø¯ÙŠÙƒ ØµÙØ­Ø© blog-post.html ØªÙ‚Ø¨Ù„ ?id=<id>
      const url = `post.html?id=${encodeURIComponent(id)}`;
      window.open(url, '_blank');
    }

    // helper: ØªØ­ÙˆÙŠÙ„ "dd/mm/yyyy" Ø¥Ù„Ù‰ Ù‚ÙŠÙ…Ø© input[type=date] (yyyy-mm-dd) Ø¥Ù† ÙˆÙØ¬Ø¯Øª
    function formatInputDate(displayDate) {
      // Ù†Ø­Ø§ÙˆÙ„ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØªØ§Ø±ÙŠØ® Ø­Ø³Ø¨ locale ar-EG Ø£Ùˆ iso
      // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø¨ØµÙŠØºØ© dd/mm/yyyy
      if (!displayDate) return '';
      const parts = displayDate.split('/');
      if (parts.length === 3) {
        const [d, m, y] = parts;
        // Ù…Ù…ÙƒÙ† ÙŠÙƒÙˆÙ† Ø³Ù†Ø© Ù‚ØµÙŠØ±Ø© Ø£Ùˆ ÙƒØ§Ù…Ù„Ø©Ø› Ù†ÙØªØ±Ø¶ y Ù‡ÙŠ 4 Ø£Ø±Ù‚Ø§Ù…
        return `${y}-${pad(m)}-${pad(d)}`;
      }
      // Ø­Ø§ÙˆÙ„ parse iso
      const dt = new Date(displayDate);
      if (!isNaN(dt)) {
        const yyyy = dt.getFullYear();
        const mm = pad(dt.getMonth() + 1);
        const dd = pad(dt.getDate());
        return `${yyyy}-${mm}-${dd}`;
      }
      return '';
    }
    function pad(v) { v = String(v); return v.length===1 ? '0'+v : v; }

    // escape HTML (Ø£Ù…Ø§Ù† Ø¨Ø³ÙŠØ· Ù„Ù„Ø¹Ø±Ø¶)
    function escapeHtml(text) {
      if (!text) return '';
      return text.replace(/[&<>"'`=\/]/g, function (s) {
        return ({
          '&': '&amp;',
          '<': '&lt;',
          '>': '&gt;',
          '"': '&quot;',
          "'": '&#39;',
          '/': '&#47;',
          '`': '&#96;',
          '=': '&#61;'
        })[s];
      });
    }

    // Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„: Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø³ÙŠØ· Ø¨Ù‚Ø±Ø§Ø¡Ø© Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù‚Ø§Ù„Ø§Øª
    async function checkStatus() {
      try {
        const snapshot = await db.collection('articles').limit(1).get();
        statusMsg.innerText = 'Ù…ØªØµÙ„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
        statusMsg.style.color = 'var(--primary)';
      } catch (err) {
        statusMsg.innerText = 'Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù‚Ø§Ø¹Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª';
        statusMsg.style.color = 'var(--danger)';
      }
    }

    // ØªØ´ØºÙŠÙ„ Ø¹Ù†Ø¯ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
    (function init() {
      imgPreview.style.opacity = 0.35;
      loadArticles();
      checkStatus();
    })();

  </script>
</body>
</html>

