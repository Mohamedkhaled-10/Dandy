<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>سلة المشتريات | Dandy</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <!-- Google Fonts: Cairo + Tajawal -->
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700&family=Tajawal:wght@400;700&display=swap" rel="stylesheet">

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">


  <link rel="icon" type="image/x-icon" href="images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="images/fav-icons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/fav-icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="192x192" href="images/fav-icons/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="images/fav-icons/android-chrome-512x512.png">
  <link rel="apple-touch-icon" sizes="180x180" href="images/fav-icons/apple-touch-icon.png">
  <link rel="manifest" href="images/fav-icons/site.webmanifest">

  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8360388796897231"
     crossorigin="anonymous"></script>
  
  <style>
    :root{ --brand:#e91e63; --accent:#ff0077; --muted:#777; --panel:rgba(255,255,255,0.04); }

    /* جدول السلة على الديسكتوب */
    .cart-container{ max-width:1000px; margin:0 auto; padding:6rem 1rem 2rem; width:100%; }
    .cart-table{ width:100%; border-collapse:collapse; }
    .cart-table thead{ background:var(--accent); color:#fff; }
    .cart-table th, .cart-table td{ padding:12px; text-align:right; border-bottom:1px solid rgba(0,0,0,0.06); vertical-align:middle; }
    .cart-table img{ width:60px; border-radius:8px; }
    .qty-input{ width:60px; text-align:center; border-radius:5px; border:1px solid #ddd; padding:6px; }
    .remove-btn{ background:transparent; border:1px solid #e0e0e0; padding:6px 8px; border-radius:6px; cursor:pointer; }

/* كرت السلة للـ mobile */
@media (max-width:768px){
  .cart-table thead{ display:none; }
  .cart-table, .cart-table tbody, .cart-table tr, .cart-table td{
    display:block;
    width:100%;
    color:#000; /* النص الأساسي أسود */
  }

  .cart-table tr{
    box-shadow:0 6px 18px rgba(0,0,0,0.06);
    margin-bottom:16px;
    border-radius:12px;
    overflow:hidden;
    background:#fff;
    color:#000;
  }

  .cart-row{ display:flex; gap:10px; padding:12px; align-items:center; color:#000; }
  .cart-row .left{ width:84px; flex-shrink:0; }
  .cart-row .left img{ width:84px; height:84px; object-fit:cover; border-radius:10px; }

  .cart-row .right{ flex:1; display:flex; flex-direction:column; gap:6px; color:#000; }

  .product-name{ font-weight:700; font-size:0.95rem; color:#000; } /* اسم المنتج بالأسود */
  .product-price{ font-size:0.9rem; color:var(--accent); font-weight:600; } /* السعر بالوردي */

  .product-controls{ display:flex; gap:8px; align-items:center; justify-content:flex-end; }

  .product-controls .qty-input{
    width:72px;
    border:1px solid var(--accent); /* حدود وردي */
    border-radius:8px;
    padding:6px;
    color:#000;
    background:#fff;
  }

  .product-controls .remove-btn{
    padding:6px 10px;
    border:1px solid var(--accent);
    color:var(--accent);
    background:transparent;
    border-radius:8px;
    cursor:pointer;
  }

  .product-controls .remove-btn:hover{
    background:var(--accent);
    color:#fff;
  }

  /* مجموع كل منتج */
  .cart-row .right .subtotal{
    margin-left:auto;
    font-weight:700;
    color:#000;
  }
}


    /* المودال العام */
    .modal{ display:none; position:fixed; inset:0; background:rgba(0,0,0,0.6); z-index:9999; align-items:center; justify-content:center; padding:1rem; }
    .modal.show{ display:flex; }
    .modal-content{ background:#fff; border-radius:14px; max-width:520px; width:100%; padding:1.5rem; box-shadow:0 12px 40px rgba(0,0,0,0.2); position:relative; }
    .modal-content h2{ margin:0 0 0.75rem 0; color:var(--accent); }
    .close-btn{ position:absolute; left:12px; top:12px; font-size:1.5rem; cursor:pointer; color:var(--brand); }
    .badge-note{ background:linear-gradient(90deg,var(--accent),#ff58a8); color:#fff; padding:6px 10px; border-radius:999px; display:inline-block; font-weight:700; }

    /* الفورم */
    form input, form select{ padding:0.6rem; border-radius:8px; border:1px solid #ddd; width:100%; box-sizing:border-box; }
    form label{ font-weight:600; margin-bottom:6px; display:block; }
    .btn{ background:var(--brand); color:#fff; border:none; padding:0.7rem 1rem; border-radius:25px; cursor:pointer; }
    .secondary{ background:#fff; color:var(--brand); border:1px solid var(--brand); }

    /* اجمالي وصادرات */
    .cart-footer{ display:flex; justify-content:space-between; align-items:center; gap:12px; margin-top:1rem; flex-wrap:wrap; }
    .cart-total{ font-weight:800; font-size:1.2rem; }
    .shipping-note{ color:var(--muted); font-size:0.95rem; }

    /* لون النص الخاص بالـ label أسود */
#order-form-container label {
  color: #000;
  font-weight: 600; /* اختياري لتوضيح العناوين */
}

/* الفوتر مثبت في أسفل الصفحة */
body {
  display:flex;
  min-height:100vh;
  flex-direction:column;
  margin:0;
}

footer {
  margin-top:auto;
  padding:2rem 1rem;
}

.remove-btn {
  background: #e53935;       /* أحمر واضح */
  color: #fff;               /* كتابة بيضاء */
  border: none;
  padding: 0.45rem 0.9rem;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
  transition: background 0.2s ease;
}

.remove-btn:hover {
  background: #c62828;      /* أحمر أغمق عند الـ hover */
}

</style>
</head>
<body>

<!-- Navigation -->
<nav dir="rtl">
  <div class="logo">
    <img src="images/logo.png" alt="الشعار" />
    <h1>DANDY</h1>
  </div>
  <ul>
    <li><a href="index.html">الرئيسية</a></li>
    <li><a href="all-products.html">المنتجات</a></li>
    <li><a href="special-offers.html">العروض</a></li>
    <li><a href="blog.html">المقالات</a></li>
    <li class="dropdown">
      <a href="#">المزيد ▾</a>
      <ul class="dropdown-menu">
        <li><a href="client-reviews.html">ثقة العملاء</a></li>
        <li><a href="about-us.html">من نحن</a></li>
      </ul>
    </li>
  </ul>
  <div class="hamburger" aria-label="القائمة">
    <span class="line"></span>
    <span class="line"></span>
    <span class="line"></span>
  </div>
</nav>

<!-- Mobile Menu -->
<div class="menubar" dir="rtl" aria-hidden="true">
  <ul>
    <li><a href="index.html">الرئيسية</a></li>
    <li><a href="all-products.html">المنتجات</a></li>
    <li><a href="special-offers.html">العروض</a></li>
    <li><a href="client-reviews.html">ثقة العملاء</a></li>
    <li><a href="blog.html">المقالات</a></li>
    <li><a href="about-us.html">من نحن</a></li>
  </ul>

  <div class="side-bottom-links">
    <a href="privacy-policy.html">سياسة الخصوصية</a>
    <span>|</span>
    <a href="terms.html">الشروط والأحكام</a>
  </div>
</div>
<section class="cart-section">
  <div class="cart-container">
    <h2 style="text-align:center; margin-bottom:1rem;">سلة المشتريات</h2>

    <table class="cart-table" aria-live="polite">
      <thead>
        <tr>
          <th style="padding:12px; text-align:right;">صورة</th>
          <th style="padding:12px; text-align:right;">المنتج</th>
          <th style="padding:12px; text-align:right;">السعر</th>
          <th style="padding:12px; text-align:right;">الكمية</th>
          <th style="padding:12px; text-align:right;">الإجمالي</th>
          <th style="padding:12px; text-align:center;">حذف</th>
        </tr>
      </thead>
      <tbody id="cart-items"></tbody>
    </table>

    <div class="cart-footer">
      <div>
        <div id="cart-total" class="cart-total"></div>
        <div class="shipping-note" id="shipping-note">تنويه: سعر الشحن يختلف حسب المحافظة وسيتم إضافته عند تأكيد الطلب.</div>
      </div>
      <div style="text-align:right;">
        <button id="checkout-btn" class="btn">إتمام الشراء</button>
      </div>
    </div>
  </div>
</section>

<!-- نموذج الطلب -->
<div id="order-form-container" class="modal" aria-hidden="true">
  <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="order-title">
    <span id="close-form" class="close-btn" aria-label="إغلاق">×</span>
    <h2 id="order-title">إتمام الشراء</h2>

    <form id="order-form">
      <label>الاسم</label>
      <input type="text" name="name" placeholder="الاسم" required />

      <label>البريد الإلكتروني (اختياي)</label>
      <input type="email" name="email" placeholder="البريد الإلكتروني"/>

      <label>رقم الهاتف</label>
      <input type="tel" name="phone" placeholder="رقم الهاتف" required />

      <label>المحافظة</label>
      <select name="governorate" required>
        <option value="">اختر المحافظة</option>
        <option>القاهرة</option>
        <option>الجيزة</option>
        <option>الإسكندرية</option>
        <option>الأسكندرية</option>
        <option>بورسعيد</option>
        <option>السويس</option>
        <option>دمياط</option>
        <option>الدقهلية</option>
        <option>الشرقية</option>
        <option>القليوبية</option>
        <option>الغربية</option>
        <option>المنوفية</option>
        <option>كفر الشيخ</option>
        <option>البحيرة</option>
        <option>الإسماعيلية</option>
        <option>شمال سيناء</option>
        <option>جنوب سيناء</option>
        <option>بني سويف</option>
        <option>الفيوم</option>
        <option>المنيا</option>
        <option>أسيوط</option>
        <option>سوهاج</option>
        <option>قنا</option>
        <option>الأقصر</option>
        <option>أسوان</option>
        <option>الوادي الجديد</option>
      </select>


      <label>المدينة</label>
      <input type="text" name="city" placeholder="المدينة" required />

      <label>العنوان</label>
      <input type="text" name="address" placeholder="العنوان" required />

      <div style="font-size:0.95rem; color:var(--muted);">ملاحظة: سعر الشحن سيختلف باختلاف المحافظة وسيضاف لاحقًا من قبل التاجر.</div>

      <div style="display:flex; gap:8px; margin-top:10px;">
        <button type="submit" class="btn">إرسال الطلب</button>
        <button type="button" id="cancel-order" class="btn secondary">إلغاء</button>
      </div>
    </form>
  </div>
</div>

<!-- نافذة تنويه قبل إتمام الشراء -->
<div id="notice-modal" class="modal" aria-hidden="true">
  <div class="modal-content" role="dialog" aria-modal="true">
    <span id="close-notice" class="close-btn" aria-label="إغلاق">×</span>
    <h2>تنويه مهم</h2>
    <p style="line-height:1.6; margin-bottom:1rem; color: #000;">يرجى الاحتفاظ بنسخة من الفاتورة أو كود الفاتورة، فقد تحتاجها للتواصل مع التاجر أو لمراجعة الطلب. كما ننصح بالاحتفاظ برابط الفاتورة.</p>
    <div style="display:flex; gap:8px; justify-content:center;">
      <button id="proceed-order" class="btn">متابعة وفتح نموذج الطلب</button>
      <button id="close-notice-cancel" class="btn secondary">إلغاء</button>
    </div>
  </div>
</div>

<!-- Footer -->
<footer>
  <div class="footer-grid">
    <div class="footer-col footer-social">
      <h4>تابعينا</h4>
      <div class="social-icons">
        <a href="https://www.facebook.com/profile.php?id=61563039704396"><i class="fab fa-facebook-f"></i></a>
        <a href="https://www.instagram.com/dandy_skincare_cosmotics"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-whatsapp"></i></a>
      </div>
      <div class="footer-links">
        <a href="privacy-policy.html">سياسة الخصوصية</a>
        <span>|</span>
        <a href="terms.html">الشروط والأحكام</a>
      </div>
      <p class="rights">© 2025 Dandy. جميع الحقوق محفوظة.</p>
    </div>
  </div>
</footer>

<!-- Firebase & JS -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>
<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDqYY4EF0Nig9aBOxmWZJA8D-4Gr4tT-UU",
  authDomain: "dandy-562fc.firebaseapp.com",
  databaseURL: "https://dandy-562fc-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "dandy-562fc",
  storageBucket: "dandy-562fc.appspot.com",
  messagingSenderId: "454972972842",
  appId: "1:454972972842:web:fedc5e92e258a06ca08853"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// عناصر الصفحة
const cartItemsEl = document.getElementById('cart-items');
const cartTotalDiv = document.getElementById('cart-total');
const checkoutBtn = document.getElementById('checkout-btn');
const noticeModal = document.getElementById('notice-modal');
const closeNotice = document.getElementById('close-notice');
const closeNoticeCancel = document.getElementById('close-notice-cancel');
const proceedOrder = document.getElementById('proceed-order');
const orderFormContainer = document.getElementById('order-form-container');
const closeForm = document.getElementById('close-form');
const orderForm = document.getElementById('order-form');
const cancelOrderBtn = document.getElementById('cancel-order');

let cart = JSON.parse(localStorage.getItem('cart')) || [];

function formatCurrency(num){
  // صيغة بسيطة: 2 أرقام عشرية
  return Number(num).toFixed(2) + ' جنيه';
}

function renderCart(){
  if(!cart || cart.length === 0){
    cartItemsEl.innerHTML = '<tr><td colspan="6" style="text-align:center; padding:20px;">سلتك فارغة.</td></tr>';
    cartTotalDiv.innerHTML = '';
    return;
  }

  let total = 0;
  // لو في شاشة موبايل نعرض بطريقة الكرات
  const isMobile = window.matchMedia('(max-width:768px)').matches;

  cartItemsEl.innerHTML = '';

  cart.forEach(item => {
    const price = parseFloat(String(item.price).replace(/[^0-9.-]+/g, '')) || 0;
    total += price * item.quantity;

    if(isMobile){
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td>
          <div class="cart-row">
            <div class="left"><img src="${item.image}" alt="${item.name}"></div>
            <div class="right">
              <div class="product-name">${item.name}</div>
              <div class="product-price">${formatCurrency(price)}</div>
              <div class="product-controls">
                <input type="number" min="1" value="${item.quantity}" data-id="${item.id}" class="qty-input">
                <button class="remove-btn" data-id="${item.id}">حذف</button>
                <div style="margin-left:auto; font-weight:700;">${formatCurrency(price*item.quantity)}</div>
              </div>
            </div>
          </div>
        </td>
      `;
      cartItemsEl.appendChild(tr);
    } else {
      const tr = document.createElement('tr');
      tr.innerHTML = `
        <td><img src="${item.image}" alt="${item.name}"></td>
        <td>${item.name}</td>
        <td>${formatCurrency(price)}</td>
        <td><input type="number" min="1" value="${item.quantity}" data-id="${item.id}" class="qty-input"></td>
        <td>${formatCurrency(price*item.quantity)}</td>
<td style="text-align:center;">
  <button class="remove-btn" data-id="${item.id}">حذف</button>
</td>
      `;
      cartItemsEl.appendChild(tr);
    }
  });

  cartTotalDiv.innerHTML = `الإجمالي: ${formatCurrency(total)}`;

  // حذف
  document.querySelectorAll('.remove-btn').forEach(btn=>{
    btn.addEventListener('click', e=>{
      const id = e.currentTarget.dataset.id;
      cart = cart.filter(i=>i.id !== id);
      localStorage.setItem('cart', JSON.stringify(cart));
      renderCart();
    });
  });

  // تغيير الكمية
  document.querySelectorAll('.qty-input').forEach(input=>{
    input.addEventListener('change', e=>{
      const id = e.currentTarget.dataset.id;
      let value = parseInt(e.currentTarget.value) || 1;
      if(value < 1) value = 1;
      cart = cart.map(i=> i.id===id ? {...i, quantity: value} : i);
      localStorage.setItem('cart', JSON.stringify(cart));
      renderCart();
    });
  });
}

renderCart();

// فتح نافذة التنويه عند الضغط على إتمام الشراء
checkoutBtn.addEventListener('click', ()=>{
  if(!cart || cart.length === 0){
    alert('سلتك فارغة!');
    return;
  }
  noticeModal.classList.add('show');
  noticeModal.setAttribute('aria-hidden', 'false');
});

// اغلاق التنويه
closeNotice.addEventListener('click', ()=>{
  noticeModal.classList.remove('show');
  noticeModal.setAttribute('aria-hidden', 'true');
});
closeNoticeCancel.addEventListener('click', ()=>{
  noticeModal.classList.remove('show');
  noticeModal.setAttribute('aria-hidden', 'true');
});

// متابعة وفتح الفورم
proceedOrder.addEventListener('click', ()=>{
  noticeModal.classList.remove('show');
  noticeModal.setAttribute('aria-hidden', 'true');
  orderFormContainer.classList.add('show');
  orderFormContainer.setAttribute('aria-hidden', 'false');
});

// اغلاق الفورم
closeForm.addEventListener('click', ()=>{
  orderFormContainer.classList.remove('show');
  orderFormContainer.setAttribute('aria-hidden', 'true');
});
cancelOrderBtn.addEventListener('click', ()=>{
  orderFormContainer.classList.remove('show');
  orderFormContainer.setAttribute('aria-hidden', 'true');
});

// اغلاق عند الضغط خارج المحتوى
[noticeModal, orderFormContainer].forEach(modalEl=>{
  modalEl.addEventListener('click', (e)=>{
    if(e.target === modalEl){
      modalEl.classList.remove('show');
      modalEl.setAttribute('aria-hidden', 'true');
    }
  });
});

// ارسال الطلب - يتضمن التحقق البسيط وارسال للفايربيز
orderForm.addEventListener('submit', async (e)=>{
  e.preventDefault();

  const name = orderForm.name.value.trim();
  const email = orderForm.email.value.trim();
  const phone = orderForm.phone.value.trim();
  const governorate = orderForm.governorate.value;
  const city = orderForm.city.value.trim();
  const address = orderForm.address.value.trim();

  if(!/^[\u0621-\u064Aa-zA-Z\s]{2,}$/.test(name)){
    alert('الرجاء إدخال اسم صحيح (أحرف ومسافات فقط)');
    return;
  }
  if(!/^01[0125][0-9]{8}$/.test(phone)){
    alert('الرجاء إدخال رقم هاتف مصري صحيح (10 أرقام يبدأ بـ 010، 011، 012، أو 015)');
    return;
  }
  if(!governorate || !city || !address){
    alert('الرجاء تعبئة جميع الحقول المطلوبة');
    return;
  }

  const invoiceCode = 'INV-' + Math.floor(100000 + Math.random()*900000);

  const formData = {
    name, email, phone, governorate, city, address,
    products: cart,
    invoiceCode,
    timestamp: new Date().toISOString()
  };

  try{
    const newRef = db.ref('orders').push();
    await newRef.set(formData);
    const orderKey = newRef.key;

    // رقم الواتساب للتاجر - عدله هنا
    const merchantWhats = 'رقم_التاجر_بدون_مفتاح';
    const message = `مرحباً، أريد شراء المنتجات التالية:\n` +
      cart.map(p => `${p.name} × ${p.quantity}`).join('\n') +
      `\nرقم الفاتورة: ${invoiceCode}\nالاسم: ${formData.name}\nالهاتف: ${formData.phone}\nالعنوان: ${formData.governorate}, ${formData.city}, ${formData.address}`;

    if(merchantWhats && merchantWhats !== 'رقم_التاجر_بدون_مفتاح'){
      window.open(`https://wa.me/${merchantWhats}?text=${encodeURIComponent(message)}`, '_blank');
    }

    localStorage.removeItem('cart');
    // إعادة التوجيه لصفحة الفاتورة مع المعرف وكود الفاتورة
    window.location.href = `invoice.html?id=${encodeURIComponent(orderKey)}&invoice=${encodeURIComponent(invoiceCode)}`;

  }catch(err){
    console.error(err);
    alert('حدث خطأ أثناء إرسال الطلب. الرجاء المحاولة مرة أخرى.');
  }
});
</script>

<!-- Mobile menu toggle (كما في الكود الأصلي) -->
<script>
  const mobileNav = document.querySelector('.hamburger');
  const navbarSide = document.querySelector('.menubar');
  if(mobileNav && navbarSide){
    const toggleNav = () => {
      navbarSide.classList.toggle('active');
      mobileNav.classList.toggle('hamburger-active');
    };

    mobileNav.addEventListener('click', (e) => {
      e.stopPropagation();
      toggleNav();
    });

    document.addEventListener('click', (e) => {
      if (
        navbarSide.classList.contains('active') &&
        !navbarSide.contains(e.target) &&
        !mobileNav.contains(e.target)
      ) {
        navbarSide.classList.remove('active');
        mobileNav.classList.remove('hamburger-active');
      }
    });
  }

  // Hide/Show navbar on scroll
  let lastScrollTop = 0;
  const nav = document.querySelector('nav');
  if(nav){
    const navHeight = nav.offsetHeight;
    window.addEventListener('scroll', function () {
      const scrollTop = window.scrollY || document.documentElement.scrollTop;
      if (scrollTop > lastScrollTop) {
        nav.style.top = `-${navHeight}px`;
      } else {
        nav.style.top = `20px`;
      }
      lastScrollTop = scrollTop;
    });
  }
</script>
</body>
</html>



