<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>سلة المشتريات | Dandy</title>
  <link href="https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

  <link rel="icon" type="image/x-icon" href="images/favicon.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="images/fav-icons/favicon-16x16.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/fav-icons/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="192x192" href="images/fav-icons/android-chrome-192x192.png">
  <link rel="icon" type="image/png" sizes="512x512" href="images/fav-icons/android-chrome-512x512.png">
  <link rel="apple-touch-icon" sizes="180x180" href="images/fav-icons/apple-touch-icon.png">
  <link rel="manifest" href="images/fav-icons/site.webmanifest">

  <style>
/* جدول السلة */
.cart-table img {
  width:60px;
  border-radius:8px;
}

.cart-table th, .cart-table td {
  border-bottom:1px solid #ff00b3;
}

.cart-table td input[type="number"] {
  width:50px;
  text-align:center;
  border-radius:5px;
  border:1px solid #cccccc;
  padding:4px;
}

/* Responsive */
@media (max-width:768px) {
  .cart-table thead {
    display:none;
  }
  .cart-table, .cart-table tbody, .cart-table tr, .cart-table td {
    display:block;
    width:100%;
  }
  .cart-table tr {
    margin-bottom:15px;
    border-bottom:2px solid #ff0080;
  }
  .cart-table td {
    text-align:right;
    padding:10px 5px;
    position:relative;
  }
  .cart-table td::before {
    content: attr(data-label);
    position:absolute;
    left:0;
    top:10px;
    font-weight:bold;
  }
}

/* الفوتر مثبت في أسفل الصفحة */
body {
  display:flex;
  min-height:100vh;
  flex-direction:column;
  margin:0;
}

footer {
  margin-top:auto;
  padding:2rem 1rem;
}
</style>
</head>
<body>

<!-- Navigation -->
<nav dir="rtl">
  <div class="logo">
    <img src="images/logo.png" alt="الشعار" />
    <h1>DANDY</h1>
  </div>
  <ul>
    <li><a href="index.html">الرئيسية</a></li>
    <li><a href="all-products.html">المنتجات</a></li>
    <li><a href="special-offers.html">العروض</a></li>
    <li><a href="blog.html">المقالات</a></li>
    <li class="dropdown">
      <a href="#">المزيد ▾</a>
      <ul class="dropdown-menu">
        <li><a href="client-reviews.html">ثقة العملاء</a></li>
        <li><a href="about-us.html">من نحن</a></li>
      </ul>
    </li>
  </ul>
  <div class="hamburger" aria-label="القائمة">
    <span class="line"></span>
    <span class="line"></span>
    <span class="line"></span>
  </div>
</nav>

<!-- Mobile Menu -->
<div class="menubar" dir="rtl" aria-hidden="true">
  <ul>
    <li><a href="index.html">الرئيسية</a></li>
    <li><a href="all-products.html">المنتجات</a></li>
    <li><a href="special-offers.html">العروض</a></li>
    <li><a href="client-reviews.html">ثقة العملاء</a></li>
    <li><a href="blog.html">المقالات</a></li>
    <li><a href="about-us.html">من نحن</a></li>
  </ul>
  <div class="side-bottom-links">
    <a href="privacy-policy.html">سياسة الخصوصية</a>
    <span>|</span>
    <a href="terms.html">الشروط والأحكام</a>
  </div>
</div>

<!-- ✅ قسم سلة المشتريات -->
<section class="cart-section" style="padding:6rem;">
  <h2 style="text-align:center; margin-bottom:2rem;">سلة المشتريات</h2>
  
  <div class="cart-container" style="max-width:1000px; margin:0 auto;">
    <table class="cart-table" style="width:100%; border-collapse:collapse;">
      <thead style="background:#ff0077;">
        <tr>
          <th style="padding:12px; text-align:right;">صورة</th>
          <th style="padding:12px; text-align:right;">المنتج</th>
          <th style="padding:12px; text-align:right;">السعر</th>
          <th style="padding:12px; text-align:right;">الكمية</th>
          <th style="padding:12px; text-align:right;">الإجمالي</th>
          <th style="padding:12px; text-align:center;">حذف</th>
        </tr>
      </thead>
      <tbody id="cart-items"></tbody>
    </table>
    <div id="cart-total" style="text-align:right; font-weight:bold; margin-top:1rem; font-size:1.2rem;"></div>
    <div style="text-align:right; margin-top:1rem;">
      <button id="checkout-btn" style="background:#e91e63; color:white; border:none; padding:0.7rem 1.5rem; border-radius:25px; cursor:pointer;">إتمام الشراء</button>
    </div>
  </div>
</section>

<!-- نموذج الطلب -->
<div id="order-form-container" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; 
    background:rgba(0,0,0,0.7); justify-content:center; align-items:center; z-index:9999; padding:1rem;">
  <div style="background:white; padding:2rem; border-radius:15px; max-width:500px; width:100%; position:relative;
              box-shadow: 0 8px 20px rgba(0,0,0,0.3);">
    
    <!-- زر الإغلاق -->
    <span id="close-form" style="position:absolute; top:10px; left:10px; cursor:pointer; font-size:1.8rem; font-weight:bold; color:#e91e63">×</span>
    
    <h2 style="text-align:center; margin-bottom:1.5rem; font-family:'Tajawal', sans-serif; color: #ff0077;">إتمام الشراء</h2>
    
    <form id="order-form" style="display:flex; flex-direction:column; gap:1rem;">
      <input type="text" name="name" placeholder="الاسم" required style="padding:0.6rem; border-radius:8px; border:1px solid #ccc; width:100%;"/>
      <input type="email" name="email" placeholder="البريد الإلكتروني" required style="padding:0.6rem; border-radius:8px; border:1px solid #ccc; width:100%;"/>
      <input type="tel" name="phone" placeholder="رقم الهاتف" required style="padding:0.6rem; border-radius:8px; border:1px solid #ccc; width:100%;"/>
      <input type="text" name="country" placeholder="الدولة" required style="padding:0.6rem; border-radius:8px; border:1px solid #ccc; width:100%;"/>
      <input type="text" name="city" placeholder="المدينة" required style="padding:0.6rem; border-radius:8px; border:1px solid #ccc; width:100%;"/>
      <input type="text" name="address" placeholder="العنوان" required style="padding:0.6rem; border-radius:8px; border:1px solid #ccc; width:100%;"/>
      
      <button type="submit" style="background:#e91e63; color:white; border:none; padding:0.7rem; border-radius:25px; font-size:1rem; cursor:pointer; margin-top:0.5rem;">
        إرسال الطلب
      </button>
    </form>
  </div>
</div>

<!-- نافذة تنويه قبل إتمام الشراء -->
<div id="notice-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(0,0,0,0.6); justify-content:center; align-items:center; z-index:10000; padding:1rem;">
  <div style="background:white; padding:2rem; border-radius:15px; max-width:500px; width:100%; text-align:center; 
              box-shadow:0 8px 20px rgba(0,0,0,0.3); position:relative; font-family:'Tajawal', sans-serif;">
    <span id="close-notice" style="position:absolute; top:10px; left:10px; cursor:pointer; font-size:1.5rem; font-weight:bold; color:#e91e63;">×</span>
    <h2 style="color:#e91e63; margin-bottom:1rem;">تنويه مهم</h2>
    <p style="line-height:1.6; margin-bottom:1.5rem;">
      يرجى الاحتفاظ بنسخة من الفاتورة أو كود الفاتورة، فقد تحتاجها للتواصل مع التاجر أو لمراجعة الطلب.<br>
      كما ننصح بالاحتفاظ برابط الفاتورة.
    </p>
    <button id="proceed-order" style="background:#e91e63; color:white; border:none; padding:0.7rem 1.5rem;
        border-radius:25px; font-size:1rem; cursor:pointer;">متابعة وفتح نموذج الطلب</button>
  </div>
</div>

<!-- Footer -->
<footer>
  <div class="footer-grid">
    <div class="footer-col footer-social">
      <h4>تابعينا</h4>
      <div class="social-icons">
        <a href="https://www.facebook.com/profile.php?id=61563039704396"><i class="fab fa-facebook-f"></i></a>
        <a href="https://www.instagram.com/dandy_skincare_cosmotics"><i class="fab fa-instagram"></i></a>
        <a href="#"><i class="fab fa-whatsapp"></i></a>
      </div>
      <div class="footer-links">
        <a href="privacy-policy.html">سياسة الخصوصية</a>
        <span>|</span>
        <a href="terms.html">الشروط والأحكام</a>
      </div>
      <p class="rights">© 2025 Dandy. جميع الحقوق محفوظة.</p>
    </div>
  </div>
</footer>

<!-- Firebase & JS -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
// Firebase Config
const firebaseConfig = {
  apiKey: "AIzaSyDqYY4EF0Nig9aBOxmWZJA8D-4Gr4tT-UU",
  authDomain: "dandy-562fc.firebaseapp.com",
  databaseURL: "https://dandy-562fc-default-rtdb.europe-west1.firebasedatabase.app",
  projectId: "dandy-562fc",
  storageBucket: "dandy-562fc.appspot.com",
  messagingSenderId: "454972972842",
  appId: "1:454972972842:web:fedc5e92e258a06ca08853"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// إدارة السلة
const cartItemsDiv = document.getElementById("cart-items");
const cartTotalDiv = document.getElementById("cart-total");
const checkoutBtn = document.getElementById("checkout-btn");
let cart = JSON.parse(localStorage.getItem("cart")) || [];

function renderCart(){
  if(cart.length === 0){
    cartItemsDiv.innerHTML = '<tr><td colspan="6" style="text-align:center;">سلتك فارغة.</td></tr>';
    cartTotalDiv.innerHTML = '';
    return;
  }

  let total = 0;
  cartItemsDiv.innerHTML = '';
  cart.forEach(item => {
    const price = parseFloat(item.price.replace(/[^0-9.-]+/g,"")) || 0;
    total += price * item.quantity;

    const tr = document.createElement('tr');

    tr.innerHTML = `
      <td data-label="صورة"><img src="${item.image}" alt="${item.name}"></td>
      <td data-label="المنتج">${item.name}</td>
      <td data-label="السعر">${item.price}</td>
      <td data-label="الكمية">
        <input type="number" min="1" value="${item.quantity}" data-id="${item.id}" class="qty-input">
      </td>
      <td data-label="الإجمالي">${(price*item.quantity).toFixed(2)}</td>
      <td data-label="حذف" style="text-align:center;">
        <button class="remove-btn" data-id="${item.id}" style="padding:0.3rem 0.6rem; cursor:pointer;">حذف</button>
      </td>
    `;

    cartItemsDiv.appendChild(tr);
  });

  cartTotalDiv.innerHTML = `الإجمالي: ${total.toFixed(2)} جنيه`;

  // حذف عنصر
  document.querySelectorAll(".remove-btn").forEach(btn=>{
    btn.addEventListener("click", e=>{
      const id = e.target.dataset.id;
      cart = cart.filter(item=>item.id !== id);
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    });
  });

  // تعديل الكمية
  document.querySelectorAll(".qty-input").forEach(input=>{
    input.addEventListener("change", e=>{
      const id = e.target.dataset.id;
      const value = parseInt(e.target.value) || 1;
      cart = cart.map(item => item.id===id ? {...item, quantity:value} : item);
      localStorage.setItem("cart", JSON.stringify(cart));
      renderCart();
    });
  });
}

renderCart();


// إظهار وإخفاء الفورم
checkoutBtn.addEventListener("click", () => {
  if(cart.length === 0){
    alert("سلتك فارغة!");
    return;
  }
  document.getElementById("order-form-container").style.display = 'flex';
});

const closeForm = document.getElementById("close-form");
closeForm.addEventListener("click", () => 
  document.getElementById("order-form-container").style.display = 'none'
);


// إرسال الطلب
const orderForm = document.getElementById("order-form");
orderForm.addEventListener("submit", async (e)=>{
  e.preventDefault();

  const formData = {
    name: orderForm.name.value,
    email: orderForm.email.value,
    phone: orderForm.phone.value,
    country: orderForm.country.value,
    city: orderForm.city.value,
    address: orderForm.address.value,
    products: cart,
    timestamp: new Date().toISOString()
  };

  const invoiceCode = 'INV-' + Math.floor(100000 + Math.random()*900000);
  formData.invoiceCode = invoiceCode;

  try{
    const newRef = db.ref('orders').push();
    await newRef.set(formData);
    const orderKey = newRef.key;

    const merchantWhats = 'رقم_التاجر_بدون_مفتاح'; // عدله
    const message = `مرحباً، أريد شراء المنتجات التالية:\n` +
      cart.map(p => `${p.name} × ${p.quantity}`).join("\n") +
      `\nرقم الفاتورة: ${invoiceCode}\nالاسم: ${formData.name}\nالهاتف: ${formData.phone}\nالعنوان: ${formData.country}, ${formData.city}, ${formData.address}`;

    if(merchantWhats && merchantWhats !== 'رقم_التاجر_بدون_مفتاح'){
      window.open(`https://wa.me/${merchantWhats}?text=${encodeURIComponent(message)}`, '_blank');
    }

    localStorage.removeItem("cart");
    window.location.href = `invoice.html?id=${encodeURIComponent(orderKey)}&invoice=${encodeURIComponent(invoiceCode)}`;
  }catch(err){
    console.error(err);
    alert("حدث خطأ أثناء إرسال الطلب.");
  }
});
</script>
<!-- Mobile menu toggle -->
<script>
  const mobileNav = document.querySelector(".hamburger");
  const navbarSide = document.querySelector(".menubar");

  const toggleNav = () => {
    navbarSide.classList.toggle("active");
    mobileNav.classList.toggle("hamburger-active");
  };

  mobileNav.addEventListener("click", (e) => {
    e.stopPropagation();
    toggleNav();
  });

  document.addEventListener("click", (e) => {
    if (
      navbarSide.classList.contains("active") &&
      !navbarSide.contains(e.target) &&
      !mobileNav.contains(e.target)
    ) {
      navbarSide.classList.remove("active");
      mobileNav.classList.remove("hamburger-active");
    }
  });
</script>

<!-- Hide/Show navbar on scroll -->
<script>
let lastScrollTop = 0;
const nav = document.querySelector('nav');
const navHeight = nav.offsetHeight;

window.addEventListener('scroll', function () {
  const scrollTop = window.scrollY || document.documentElement.scrollTop;
  if (scrollTop > lastScrollTop) {
    nav.style.top = `-${navHeight}px`;
  } else {
    nav.style.top = `20px`;
  }
  lastScrollTop = scrollTop;
});
</script>
<script>
  // المودال والتنويه
const noticeModal = document.getElementById("notice-modal");
const closeNotice = document.getElementById("close-notice");
const proceedOrder = document.getElementById("proceed-order");

// فتح المودال عند الضغط على "إتمام الشراء"
checkoutBtn.addEventListener("click", () => {
  if(cart.length === 0){
    alert("سلتك فارغة!");
    return;
  }
  noticeModal.style.display = 'flex';
});

// إغلاق نافذة التنويه
closeNotice.addEventListener("click", () => {
  noticeModal.style.display = 'none';
});

// عند الضغط على متابعة، يغلق المودال ويفتح الفورم
proceedOrder.addEventListener("click", () => {
  noticeModal.style.display = 'none';
  document.getElementById("order-form-container").style.display = 'flex';
});

// إغلاق الفورم نفسه
closeForm.addEventListener("click", () => {
  document.getElementById("order-form-container").style.display = 'none';
});

</script>
</body>
</html>



